function ConveyorControl()
    proximitySensorDistance = sim.readProximitySensor(sensorHandle) 
    if proximitySensorDistance>0 then
        sim.writeCustomDataBlock(conveyorHandle,'CONVMOV',sim.packTable({vel=0}))
    end
end
function SpawnParts()
    spawnZoneEmpty = sim.readProximitySensor(spawnerSensorHandle);
    local i = math.random(1,3)
    if((i==1) and (sim.getSimulationTime()-spawnTimer) >= spawnInterval and spawnZoneEmpty==0) then
        initialSelection=sim.getObjectSelection();
        sim.removeObjectFromSelection(sim.handle_all,0);
        sim.addObjectToSelection(sim.handle_single,CvxHandle1);
        sim.addObjectToSelection(sim.handle_single,meshHandle1);
        copiedObj=simCopyPasteSelectedObjects();
        CopyHandle = sim.getObjectHandle('FuelPumpCvx');
        sim.setObjectPosition(CopyHandle,spawnPointHandle,{0,0,0});
        sim.removeObjectFromSelection(sim.handle_all,0);
        sim.addObjectToSelection(initialSelection);
        noOfObjectSpawned = noOfObjectSpawned + 1;
        spawnTimer = sim.getSimulationTime();
        end
    if((i==2) and (sim.getSimulationTime()-spawnTimer) >= spawnInterval and spawnZoneEmpty==0) then
        initialSelection=sim.getObjectSelection();
        sim.removeObjectFromSelection(sim.handle_all,0);
        sim.addObjectToSelection(sim.handle_single,CvxHandle2);
        sim.addObjectToSelection(sim.handle_single,meshHandle2);
        copiedObj=simCopyPasteSelectedObjects();
        CopyHandle = sim.getObjectHandle('Oiltray');
        sim.setObjectPosition(CopyHandle,spawnPointHandle,{0,0,0});
        sim.removeObjectFromSelection(sim.handle_all,0);
        sim.addObjectToSelection(initialSelection);
        noOfObjectSpawned = noOfObjectSpawned + 1;
        spawnTimer = sim.getSimulationTime();
       end
    if((i==3) and (sim.getSimulationTime()-spawnTimer) >= spawnInterval and spawnZoneEmpty==0) then
        
        initialSelection=sim.getObjectSelection();
        sim.removeObjectFromSelection(sim.handle_all,0);
        sim.addObjectToSelection(sim.handle_single,CvxHandle3);
        sim.addObjectToSelection(sim.handle_single,meshHandle3);
        copiedObj=simCopyPasteSelectedObjects();
        CopyHandle = sim.getObjectHandle('Camshaft');
        sim.setObjectPosition(CopyHandle,spawnPointHandle,{0,0,0});
        sim.removeObjectFromSelection(sim.handle_all,0);
        sim.addObjectToSelection(initialSelection);
        noOfObjectSpawned = noOfObjectSpawned + 1;
        spawnTimer = sim.getSimulationTime();
    end
end



function sysCall_init()
    sensorHandle = sim.getObjectHandle(sim.handle_self)
    conveyorHandle=sim.getObjectHandle('ConveyorBelt')
    spawnPointHandle = sim.getObjectHandle('SpawnPoint')
    spawnerSensorHandle = sim.getObjectHandle('Proximity_sensor_spawner')
    sensorHandle = sim.getObjectHandle('Proximity_sensor')
    
    sim.writeCustomDataBlock(conveyorHandle,'CONVMOV',sim.packTable({vel=-0.5}))
    
    spawnInterval = 3;
    spawnTimer = sim.getSimulationTime();
    noOfObjectSpawned =0;
    -- Getting Object Handles
    meshHandle1 = sim.getObjectHandle('FuelPumpMesh')
    CvxHandle1 = sim.getObjectHandle('FuelPumpCvx')
    CvxHandle2 = sim.getObjectHandle('Oiltray')
    meshHandle2 = sim.getObjectHandle('Oiltraymesh')
    CvxHandle3 = sim.getObjectHandle('Camshaft')
    meshHandle3 = sim.getObjectHandle('Camshaftmesh') 
end

function sysCall_actuation()
    --ConveyorControl();    
    SpawnParts();
    proximitySensorDistance = sim.readProximitySensor(sensorHandle)
    if proximitySensorDistance >0 then
        sim.writeCustomDataBlock(conveyorHandle,'CONVMOV',sim.packTable({vel=0}))
    end
end

function sysCall_sensing()
    -- put your sensing code here
end

function sysCall_cleanup()
    -- do some clean-up here
end

